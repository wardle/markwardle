<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="http://jekyllrb.com" version="3.4.1">Jekyll</generator><link href="https://www.wardle.org/feed.xml" rel="self" type="application/atom+xml" /><link href="https://www.wardle.org/" rel="alternate" type="text/html" /><updated>2017-04-28T22:10:08+01:00</updated><id>https://www.wardle.org/</id><title type="html">Dr. Mark Wardle</title><subtitle>Consultant Neurologist, clinical informatics, entrepreneur and software developer.
</subtitle><entry><title type="html">The importance of cohorts… and SNOMED-CT</title><link href="https://www.wardle.org/clinical-informatics/2017/04/28/importance-of-cohorts.html" rel="alternate" type="text/html" title="The importance of cohorts... and SNOMED-CT" /><published>2017-04-28T14:42:42+01:00</published><updated>2017-04-28T14:42:42+01:00</updated><id>https://www.wardle.org/clinical-informatics/2017/04/28/importance-of-cohorts</id><content type="html" xml:base="https://www.wardle.org/clinical-informatics/2017/04/28/importance-of-cohorts.html">&lt;blockquote&gt;
  &lt;p&gt;A cohort is a group of patients who share a defining characteristic.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In clinical research, researchers recruit a group of patients with a specific disease or a specific problem or who have received a specific intervention and then might monitor their progress in an observational study or monitor the effect on an intervention in an interventional study.&lt;/p&gt;

&lt;p&gt;In such studies, there is a systematic and dedicated collection of research data, usually to a high-standard using a pre-prepared schedule to avoid bias and to ensure that the appropriate data are acquired.&lt;/p&gt;

&lt;p&gt;One would think that it would be the same in routine healthcare but it is not. Most information is recorded as unstructured free-text and data collected are primarily used for administrative and managerial purposes. As I wrote in my &lt;a href=&quot;/clinical-informatics/2017/02/03/domain-driven-design.html&quot;&gt;domain-driven clinical design document&lt;/a&gt;, “As a result, we commonly know how many patients are seen in clinic, but have very little information as to why they are being seen or how they fare after  treatment.   Important  questions  such  as  ‘how  many  patients  with  Parkin-son’s disease do we care for?’, ‘what are the outcomes for patients after having a mastectomy?’ or ‘why are we seeing these patients in outpatient clinic?’ cannot be answered.”&lt;/p&gt;

&lt;p&gt;In fact, it is not just understand and assessing our services and outcomes that require this information, but new technologies such as real-time analytics, algorithmic support and artificial intelligence needs prospectively-captured data recorded at the point–of-care.&lt;/p&gt;

&lt;p&gt;Some might point to “Hospital Episode Statistics” (HES) data as a way of understanding our patients but these data are woefully incomplete and inaccurate, do not usually include outpatient episodes of care with diagnostic entities recorded using a classification system (ICD-10) rather than a clinical terminology.&lt;/p&gt;

&lt;p&gt;The logical answer is to encourage the routine and systematic collection of structured data by clinicians for clinicians.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/Cppjedy-hMo&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h1 id=&quot;snomed-ct&quot;&gt;SNOMED-CT&lt;/h1&gt;

&lt;p&gt;SNOMED-CT is a large, modern and comprehensive terminology. In the above video, you can see me entering clinical diagnostic terms quickly and having them mapped to SNOMED-CT concepts in real-time. These concepts exist within a large and complex hierarchy of relationships which give algorithmic understanding. I use this in an electronic patient record system to identify patients with motor neurone disease; it will identify patients coded with a diagnosis of “progressive bulbar palsy” but the SNOMED-CT hierarchy can be navigated to work out algorithmically that this is a type of motor neurone disease.&lt;/p&gt;

&lt;p&gt;I have explained more about SNOMED-CT in Section 4.1 of my &lt;a href=&quot;https://www.dropbox.com/s/62sg71a19voxpts/cis_design.pdf?dl=0&quot;&gt;domain-driven clinical design document&lt;/a&gt; and I have a paper in print in the &lt;a href=&quot;http://futurehospital.rcpjournal.org/content/current&quot;&gt;Future Hospital Journal&lt;/a&gt; which should be published in the next issue.&lt;/p&gt;

&lt;p&gt;SNOMED-CT isn’t limited to diagnostic concepts but includes terms for all range of concepts such as countries of birth, ethnic origins, procedures, medications, devices and even occupations. In addition, there are cross-maps which facilitate the mapping of a concept to and from other classification and terminology systems such as ICD-10 and OPCS.&lt;/p&gt;

&lt;p&gt;Here is an example of entering SNOMED-CT terms for medications:&lt;/p&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/6mvUThwm0j8&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h3 id=&quot;the-importance-of-implementation&quot;&gt;The importance of implementation&lt;/h3&gt;

&lt;p&gt;I have not been able to identify a working SNOMED-CT implementation in the UK before 2009, which means that, as far as I know, I actually had the first working system in clinical practice in the UK deployed in October 2009.&lt;/p&gt;

&lt;p&gt;I think there are five main issues when it comes to implementing SNOMED-CT:&lt;/p&gt;

&lt;h4 id=&quot;1-you-need-to-make-it-fast&quot;&gt;1. You need to make it fast.&lt;/h4&gt;

&lt;p&gt;If you have a look at the &lt;a href=&quot;http://browser.ihtsdotools.org/&quot;&gt;SNOMED International provided browser&lt;/a&gt;, you can navigate the SNOMED-CT hierarchy and get a feel for how it is structured. However, you will notice that search is very slow. While its size makes it comprehensive, it is technically challenging to implement in an effective way. It is possible to do so however as you can see from the screen recordings above.&lt;/p&gt;

&lt;h4 id=&quot;2-terminology-shouldnt-be-a-bolt-in-but-the-lingua-franca-in-your-data-models-and-your-software&quot;&gt;2. Terminology shouldn’t be a bolt-in, but the lingua franca in your data models and your software.&lt;/h4&gt;

&lt;p&gt;SNOMED-CT data entry does not need to only occur by allowing your users to search for a specific term. In my homegrown EPR, choosing locations on the face when recording botulinum toxin injections enters SNOMED-CT terms behind the scenes at the data level.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/patientcare-botox.jpg&quot; alt=&quot;Patientcare Botox&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;3-its-not-just-about-data-entry&quot;&gt;3. It’s not just about data entry.&lt;/h4&gt;

&lt;p&gt;If your terminology system is a bolt-on, then it is difficult to do anything clever with the data in real-time in order to support clinical care. If however you use SNOMED-CT to enable real-time analytics, then you can switch functionality on and off depending on clinical context. Here we analyse the patient record to generate a motor neurone disease summary and look for records of gastrostomy insertion simply by querying the patient’s data leveraging the semantic understanding that SNOMED-CT provides. &lt;img src=&quot;/images/mnd-dashboard.png&quot; alt=&quot;Mnd Dashboard&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;4-dont-start-thinking-about-subsets&quot;&gt;4. Don’t start thinking about subsets&lt;/h4&gt;

&lt;p&gt;There have been many working groups set up by different specialties to try to organise and curate subsets, limited lists of concepts from within SNOMED-CT and I strongly believe that this work is a waste of time.&lt;/p&gt;

&lt;p&gt;Instead, those people should be focused on improving SNOMED-CT as a whole, reviewing and deprecating concepts and ensuring that the concepts that are found in modern clinical practice are represented adequately.&lt;/p&gt;

&lt;p&gt;I believe that subsets have arisen due to fundamental shortcomings in the implementation of SNOMED-CT and I haven’t found a need that subsumption can’t solve by itself. Subsumption refers to the hierarchy of SNOMED-CT concepts that arises from IS-A relationships in that, “progressive bulbar palsy” IS-A type “motor neurone disease” or “bronchopneumonia” IS-A type of “respiratory disease”.&lt;/p&gt;

&lt;p&gt;Subsumption means that a decent implementation (and mine is one of them - see it at &lt;a href=&quot;https://github.com/mwardle/rsterminology&quot;&gt;https://github.com/mwardle/rsterminology&lt;/a&gt;) can use those relationships to limit the choice of users so that they don’t choose “Occupation of physiotherapist” when making a “Referral to physiotherapist” because one is an occupation and one is a type of procedure.&lt;/p&gt;

&lt;h4 id=&quot;5-it-allows-you-to-study-cohorts&quot;&gt;5. It allows you to study cohorts…&lt;/h4&gt;

&lt;p&gt;And finally, the title of the article.&lt;/p&gt;

&lt;p&gt;Once you implement SNOMED-CT, you can start to do clever things like, show me how the patient in front of me is doing compared to all of my patients with this disease. You can see this for multiple sclerosis here, but it is possible to do for other disorders as well.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/msdata-relapses.jpg&quot; alt=&quot;Msdata Relapses&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In fact, we can now do the same but sub-stratify to show how you compare to patients with a disease onset at a similar time of life or of the same gender.&lt;/p&gt;

&lt;p&gt;Defining cohorts means defining the characteristics of our patients, and SNOMED-CT is the solution. We can then stratify our patient groups according to those characteristics, whether it be their medical diagnoses, the procedures to which they have been through, their treatments current and past or any other characteristic.&lt;/p&gt;

&lt;p&gt;How can we make sense of patient reported outcome measures without understanding and stratifying our patients?&lt;/p&gt;

&lt;p&gt;Importantly, it doesn’t matter if someone has coded a diagnosis as a highly specific diagnosis as one can map this to a more generic high-level diagnosis and then use that perform aggregated analysis.&lt;/p&gt;

&lt;p&gt;Finally, how can we implement algorithmic analysis and artificial intelligence without an understand of these characteristics? Assessment of, for example, deteriorating renal function is critical on knowledge of recent diagnoses and medications given, and structured data is vital in supporting the research required in applying artificial intelligence in healthcare. The routine and systematic collection of SNOMED-CT forms a critical part of the foundation of any programme to implement such systems.&lt;/p&gt;</content><author><name></name></author><summary type="html">A cohort is a group of patients who share a defining characteristic.</summary></entry><entry><title type="html">Secure messaging… with patients in control of their data</title><link href="https://www.wardle.org/information-governance/2017/04/23/secure-messaging.html" rel="alternate" type="text/html" title="Secure messaging... with patients in control of their data" /><published>2017-04-23T09:20:28+01:00</published><updated>2017-04-23T09:20:28+01:00</updated><id>https://www.wardle.org/information-governance/2017/04/23/secure-messaging</id><content type="html" xml:base="https://www.wardle.org/information-governance/2017/04/23/secure-messaging.html">&lt;p&gt;Don’t we all want clinical information systems that support both clinicians and patients with clinical care?&lt;/p&gt;

&lt;p&gt;However, storing and using information relating to patients, whether for direct clinical care, audit and service evaluations or the secondary use of data is potentially fraught with difficulty. There are many examples such as the furore surrounding the &lt;a href=&quot;https://www.england.nhs.uk/ourwork/tsd/care-data/&quot;&gt;care.data&lt;/a&gt; NHS England project or the &lt;a href=&quot;https://www.digitalhealth.net/2017/03/ttp-gps-should-continue-patient-data-sharing/&quot;&gt;TPP SystmOne debacle&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As I have &lt;a href=&quot;/clinical-informatics/2017/03/09/google-information.html&quot;&gt;mentioned before&lt;/a&gt;, “a single misstep in either the use of data, the perceived use of data or lack of clarity surrounding either has the potential to close down any programme, however innovative.”&lt;/p&gt;

&lt;h4 id=&quot;how-then-can-we-build-systems-that-are-open-and-transparent-and-yet-secure-by-design&quot;&gt;How then can we build systems that are open and transparent and yet secure-by-design?&lt;/h4&gt;

&lt;p&gt;For many, these goals are mutually exclusive. There are many proprietary, closed systems adopting &lt;em&gt;security-by-obscurity&lt;/em&gt; with data locked away  inaccessible to third parties and low levels of interoperability. Opening up access to such systems is, by definition, something that reduces security and potentially allows important personal patient-identifiable information to be accessed inappropriately.&lt;/p&gt;

&lt;h4 id=&quot;how-do-you-give-secure-and-safe-control-of-data-to-patients&quot;&gt;How do you give secure and safe control of data to patients?&lt;/h4&gt;

&lt;p&gt;I would argue that more harm comes to patients for lack of sharing of information than excessive sharing. So many of my patients are surprised that I have not and cannot see the results of investigations and clinical opinions from other centres. Others are surprised to know that that most of us have no automatic systems to let us know about results, relying instead on crude manual systems and the receipt of a report in order to act. Such processes are prone to error; what happens if I do not receive a written report for a scan?&lt;/p&gt;

&lt;p&gt;As I have written before, we need systems that allow medicine to &lt;a href=&quot;/information-governance/2017/03/19/information-governance.html&quot;&gt;run on rails&lt;/a&gt;. Therefore, we need to open-up data access but in a verifiably safe, transparent and secure way.&lt;/p&gt;

&lt;p&gt;The solution is to put the patient at the centre of what we do and to give them control over the use of their data.&lt;/p&gt;

&lt;p&gt;The challenge then becomes how to allow patients to either opt-in or opt-out of the use of their data for different purposes in an open way as well as view for themselves how their data is used. We need systems that record patient consent and log access to data.&lt;/p&gt;

&lt;h4 id=&quot;the-danger-of-information-leakage&quot;&gt;The danger of information leakage&lt;/h4&gt;

&lt;p&gt;It is quite straightforward to create electronic systems that record a patient’s preferences and choices in a database.&lt;/p&gt;

&lt;p&gt;For example, Mr Smith might record his interest in research generally and specifically sign up for projects relating to diabetes mellitus and HIV. However, such a naive implementation would result in &lt;em&gt;information leakage&lt;/em&gt; from this metadata. We might encrypt the database, secure the server and yet still be at risk of disclosing private medical information inadvertently as a result of how different pieces of data are linked.&lt;/p&gt;

&lt;h4 id=&quot;secure-messaging&quot;&gt;Secure messaging&lt;/h4&gt;

&lt;p&gt;Similar issues arise in secure patient messaging. My patients and their advocates want to be able to contact their healthcare teams electronically. The success of my existing &lt;a href=&quot;/clinical-informatics/2017/03/13/communication-is-key.html&quot;&gt;EPR messaging solution&lt;/a&gt; is evidence that my other clinical colleagues want ways of communicating among themselves but ensure that such messages become part of the wider health record.&lt;/p&gt;

&lt;p&gt;We receive emails frequently from patients and relatives, and yet these communications are not stored as part of the health record, are not easily shared with other members of the healthcare team and are inherently insecure. Providing systems to allow secure messaging between patients and their clinical services should be an easy-win for making our services more responsive to patients.&lt;/p&gt;

&lt;p&gt;However, I have previously put off adding patient access and secure messaging to my &lt;a href=&quot;https://msdata.org.uk&quot;&gt;internet hosted EPR portal&lt;/a&gt; as I simply do not want to risk the inadvertent leak of patient information, either through accidental or malicious means. It is not difficult to envisage a system much like we have for online banking in which messages are sent and received through their dedicated website or application but what if it got hacked?&lt;/p&gt;

&lt;p&gt;We can solve some of these issues with encryption but messaging and other forms of communication are also subject to &lt;em&gt;information leakage&lt;/em&gt; as a result of the metadata relating to those communications. The security services don’t necessarily need to know what messages contain to make important inferences about the relationships between people; they know the sender and the recipient.&lt;/p&gt;

&lt;p&gt;For example if a patient emails hiv-helpdesk@nhs.net then information leakage is taking place.&lt;/p&gt;

&lt;h4 id=&quot;openconsent&quot;&gt;openconsent&lt;/h4&gt;

&lt;p&gt;I’ve been working on a small proof-of-concept application that demonstrates a way of connecting patients and services without leaking information about those relationships. It is called &lt;a href=&quot;https://github.com/wardle/openconsent&quot;&gt;openconsent&lt;/a&gt; and the source code is available on &lt;a href=&quot;https://github.com/wardle/openconsent&quot;&gt;github&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The following schematic shows the model:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/openconsent/openconsent-plan-updated.png&quot; alt=&quot;Openconsent Model Updated&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This looks complicated, but it really isn’t. The blue boxes show completed functionality within the proof-of-concept project with greyed out boxes showing work that is yet to be done.&lt;/p&gt;

&lt;p&gt;More technical information can be found in my previous two blog posts &lt;a href=&quot;/information-governance/2017/04/05/pseudonymous-consent-poc.html&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;/information-governance/2017/04/08/pseudonymous-consent.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The answer comes down to using &lt;a href=&quot;/information-governance/2017/03/19/information-governance.html&quot;&gt;pseudonymous identifiers&lt;/a&gt; to create one-way links between different types of data. This results in a system the prevents data linkage unless you already know the patient details and have permission to access data. The technical underpinnings are described in my other posts so I won’t duplicate that discussion here.&lt;/p&gt;

&lt;p&gt;The same technology can be used to implement secure messaging. Messages sent between different people and organisations suffer from the same &lt;em&gt;information leakage&lt;/em&gt; problem as a result of the metadata required to send that message, even if the content of the message is encrypted.&lt;/p&gt;

&lt;p&gt;I am now working on adding secure message functionality using public-key cryptography to encrypt the content of messages and one-way pseudonymous identifiers to encrypt the metadata relating to those messages in a similar way to the obfuscation of opt-in and opt-out preferences within the consent model.&lt;/p&gt;

&lt;p&gt;For technical readers, a review of &lt;a href=&quot;https://github.com/wardle/openconsent/blob/master/src/test/java/com/eldrix/openconsent/model/TestConsent.java&quot;&gt;some of the unit tests&lt;/a&gt; will demonstrate the use of the framework.&lt;/p&gt;

&lt;p&gt;The immediate next steps for development are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;add secure messaging&lt;/li&gt;
  &lt;li&gt;complete the REST API (although much is already complete)&lt;/li&gt;
  &lt;li&gt;add OAUTH2 server&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">Don’t we all want clinical information systems that support both clinicians and patients with clinical care?</summary></entry><entry><title type="html">Pseudonymous consent- updated</title><link href="https://www.wardle.org/information-governance/2017/04/08/pseudonymous-consent.html" rel="alternate" type="text/html" title="Pseudonymous consent- updated" /><published>2017-04-08T09:22:28+01:00</published><updated>2017-04-08T09:22:28+01:00</updated><id>https://www.wardle.org/information-governance/2017/04/08/pseudonymous-consent</id><content type="html" xml:base="https://www.wardle.org/information-governance/2017/04/08/pseudonymous-consent.html">&lt;p&gt;I have updated my &lt;a href=&quot;https://github.com/wardle/openconsent&quot;&gt;proof-of-concept project on pseudonymous consent (see github)&lt;/a&gt;. To understand the background to this blog post, please see my &lt;a href=&quot;/information-governance/2017/04/05/pseudonymous-consent-poc.html&quot;&gt;earlier post&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The design goals were&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Put patients in control of their information&lt;/li&gt;
  &lt;li&gt;Support explicit opt-in for research and opt-out for clinical services.&lt;/li&gt;
  &lt;li&gt;Avoid leaking confidential information while information is in transit or in storage.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The key to linking information in a safe way is the use of pseudonymous identifiers.&lt;/p&gt;

&lt;p&gt;The following schematic shows the updated model:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/openconsent/openconsent-model-updated.png&quot; alt=&quot;Openconsent Model Updated&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A patient can create an account at any time using their email. Potentially, this account could be validated by some external agency such as the Government Gateway or new Gov.uk VERIFY services.&lt;/p&gt;

&lt;h4 id=&quot;opt-in-projects&quot;&gt;Opt-in projects&lt;/h4&gt;
&lt;p&gt;To join a research project, we create an explicit “Registration” for that patient. A research project creates an “Episode” and, given it is an explicit opt-in type of project, data access would only be permitted if explicit consent exists. This is straightforward but the design ensures that the system cannot re-identify the patient. A project needs to obtain patient identifiable information via a different route.&lt;/p&gt;

&lt;h4 id=&quot;opt-out-projects&quot;&gt;Opt-out projects&lt;/h4&gt;
&lt;p&gt;But what if I want to write a new “intelligent agent” that will monitor patients, look for patients on methotrexate and then check that they have had their required blood monitoring and that the blood results are within the ranges we expect? Methotrexate can cause blood dyscrasias and so needs regular blood monitoring. I want the care I provide to patients to &lt;a href=&quot;/information-governance/2017/03/19/information-governance.html&quot;&gt;run on rails&lt;/a&gt; so how can I introduce an application that accesses patients’ records in a safe way that is defensible in regard to information governance and the media? I really don’t wish to be on the front page of the newspapers!&lt;/p&gt;

&lt;p&gt;The steps are as so:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;To access patient data, the project (in this case my methotrexate monitoring application), registers an episode using the known patient identifiers. It is acting on behalf of an NHS organisation.&lt;/li&gt;
  &lt;li&gt;The “system” permits access to health data as this is an opt-out project, but data access is logged in a verifiable log.&lt;/li&gt;
  &lt;li&gt;A patient wishes to opt-out. They already have a validated account. It has been endorsed and linked to the authority that oversees the project.&lt;/li&gt;
  &lt;li&gt;The patient (and only the patient) can then look up all episodes relating to him or herself and explicitly opt-out by recording that information against the episode. This change would be logged in a verifiable log as previously discussed.&lt;/li&gt;
  &lt;li&gt;For the project, data access is no longer permitted.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The critical features are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;the avoidance of information leakage; making inferences about the patient simply as a result of the opt-in and opt-out of projects.&lt;/li&gt;
  &lt;li&gt;providing some degree of proof of trustworthiness in that the above logic could be distributed across multiple systems and we can vouch that patient information cannot be shared inappropriately and without being logged.&lt;/li&gt;
  &lt;li&gt;ensuring that even insiders cannot find out more information about a patient than they should. A project cannot find out what else the patient has consented for and likewise, an attacker of the patient accounts cannot find out to which projects the patient has opted-in or out of.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There is more work to do to make it a usable system, but the &lt;a href=&quot;https://github.com/wardle/openconsent/blob/master/src/test/java/com/eldrix/openconsent/model/TestPatients.java&quot;&gt;test harness&lt;/a&gt; demonstrates how it would work in practice.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">I have updated my proof-of-concept project on pseudonymous consent (see github). To understand the background to this blog post, please see my earlier post.</summary></entry><entry><title type="html">Pseudonymous consent</title><link href="https://www.wardle.org/information-governance/2017/04/05/pseudonymous-consent-poc.html" rel="alternate" type="text/html" title="Pseudonymous consent" /><published>2017-04-05T14:45:28+01:00</published><updated>2017-04-05T14:45:28+01:00</updated><id>https://www.wardle.org/information-governance/2017/04/05/pseudonymous-consent-poc</id><content type="html" xml:base="https://www.wardle.org/information-governance/2017/04/05/pseudonymous-consent-poc.html">&lt;blockquote&gt;
  &lt;p&gt;Update: 8th April 2017. I have refined the data model in a &lt;a href=&quot;/information-governance/2017/04/08/pseudonymous-consent.html&quot;&gt;subsequent post&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;In earlier posts relating to &lt;a href=&quot;/clinical-informatics/2017/03/09/google-information.html&quot;&gt;“What I would do if I were Google”&lt;/a&gt; and &lt;a href=&quot;/information-governance/2017/03/19/information-governance.html&quot;&gt;“Balancing information governance and innovation in the NHS”&lt;/a&gt;, I discussed the importance of balance between information governance and open innovation within healthcare informatics focusing on the difficulty in handling sensitive medical data.&lt;/p&gt;

&lt;p&gt;Writing a blog forces one to reflect; for instance, what is it that you are trying to do? I’ve concluded that my primary objective within healthcare informatics is to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;make healthcare information available at the point-of-care in order to support clinical care&lt;sup&gt;&lt;a href=&quot;#care-of-patients&quot;&gt;a&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To achieve that, I want:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;better use of real-time analytics to aggregate data among patient cohorts and support clinical decision making&lt;/li&gt;
  &lt;li&gt;a mixed-economy of healthcare applications that can interoperate and leverage core infrastructure and services with a reduced focus on monolithic enterprise-wide systems&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;And to achieve those, I want:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;greater use of structured clinical information captured and used at the point-of-care including use of robust information models, open standards and terminology such as HL7 FHIR, openEHR and SNOMED CT.&lt;/li&gt;
  &lt;li&gt;an open-source infrastructure to permit interoperability between vendors.&lt;/li&gt;
  &lt;li&gt;a robust information governance framework&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;supporting-information-governance&quot;&gt;Supporting information governance&lt;/h2&gt;

&lt;p&gt;One can support &lt;a href=&quot;https://en.wikipedia.org/wiki/Information_governance&quot;&gt;information governance&lt;/a&gt; by adopting appropriate &lt;a href=&quot;http://www.wales.nhs.uk/nwis/page/52618&quot;&gt;policies and procedures&lt;/a&gt;, by creating formal &lt;a href=&quot;https://www.igt.hscic.gov.uk/Caldicott2Legislation.aspx?tk=428276172817610&amp;amp;lnv=18&amp;amp;cb=8cf4d31b-5ea7-4f07-b8b5-34f9ee732d4a&quot;&gt;legislation&lt;/a&gt;, &lt;a href=&quot;https://www.igt.hscic.gov.uk&quot;&gt;toolkits&lt;/a&gt; and by instituting technical solutions such as authentication, authorisation, secure audit logs and encryption.&lt;/p&gt;

&lt;p&gt;Essentially we need to strike a balance between making clinical information available and ensuring that this sensitive information is not seen by the wrong people in a complex, heterogeneous and distributed environment in which there are multiple actors such as clinical staff, patients, managers, organisations and commissioners.&lt;/p&gt;

&lt;p&gt;I think that there are three broad concepts we need to cover:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Pseudonymisation and data linkage.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Secure and verifiable audit trails&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Put patients at the heart of what we do and give them control.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I have previously discussed the use of pseudonymisation as a technique to permit safe data linkage within and between disparate datasets. In addition, I covered the use of a project- or service- specific pseudonym that could uniquely identify a patient for that particular research project or clinical service. Importantly, pseudonymisation uses a one-way mathematical function so that, given a pseudonym alone, we cannot re-identify a patient. However, we can re-link these data if we have the shared secrets that were used to generate the pseudonym.&lt;/p&gt;

&lt;p&gt;I gave an overview of &lt;a href=&quot;/merkle-trees/2017/03/20/merkle-trees.html&quot;&gt;Merkle trees&lt;/a&gt; in a previous blog post. Essentially, although I have built in audit trail functionality into my own EPR, there is nothing stopping me accessing patient records inappropriately and removing those log entries directly from the database as I have administrator access. Do you trust me? Perhaps. But do you trust a commercial entity? Perhaps not. A verifiable audit log potentially solves this issue, by ensuring that no-one can tamper with the log.&lt;/p&gt;

&lt;p&gt;Putting patients in control of where and how their information is used means that there are &lt;em&gt;no surprises&lt;/em&gt; because patients have explicitly agreed.&lt;/p&gt;

&lt;h3 id=&quot;key-security-concerns&quot;&gt;Key security concerns&lt;/h3&gt;

&lt;p&gt;Is it possible to create an architecture which is secure-by-design?&lt;/p&gt;

&lt;p&gt;The use of pseudonyms generated on a per-use or per-service basis, possibly on the fly, potentially allows an interesting security feature in that inappropriate dataset access cannot occur simply because the data cannot be linked to the patient, rather than relying on systems themselves try to manage which data sources are permitted or not. Access to data is therefore the result of data linkage.&lt;/p&gt;

&lt;p&gt;As a result, it becomes possible to allow untrusted third parties access to an infrastructure but their access to disparate distributed data sources is impossible as a result of a lack of linkage. In addition, by virtue of requesting access, the third party &lt;em&gt;must&lt;/em&gt; make a data access request and therefore have their access logged appropriately.&lt;/p&gt;

&lt;p&gt;One fundamental security concern is that a centralised registry of permissions, opt-ins and opt-outs in itself gives away important potentially patient identifiable information. For instance, membership of a cohort of patients in a genito-urinary clinic &lt;em&gt;in itself&lt;/em&gt; gives information to potential third parties. Therefore, it is important that such information is inaccessible by design.&lt;/p&gt;

&lt;p&gt;Sensitive information will be both stored and subsequently transmitted; both require protecting. The most difficult is protecting stored data and I have tried to create a proof-of-concept that could cope with whole system compromise. Assuming an attacker has full access to a dump of the database, it should be possible to take reasonable precautions to prevent re-identification. However, this requirement means that simple join-tables in a relationship database between a patient and their consent/permissions cannot be used.&lt;/p&gt;

&lt;h3 id=&quot;proof-of-concept&quot;&gt;Proof-of-concept&lt;/h3&gt;

&lt;p&gt;There is nothing like trying to create a small working solution as a proof-of-concept.&lt;/p&gt;

&lt;p&gt;The source code is available here: &lt;a href=&quot;https://www.github.com/wardle/openconsent&quot;&gt;https://www.github.com/wardle/openconsent&lt;/a&gt;.  Conceptually, the data model is as follows:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/openconsent/openconsent-model.png&quot; alt=&quot;Openconsent Model&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Here the Patient entity records the name of the patient and uses an email address for login. When a user creates an account, the password is used to create a salted digest for future password-checks and used to create a different digest used to encrypt an encryption key. This key is used to encrypt other information including the name of the patient and the episode identifiers held in the registrations table.&lt;/li&gt;
  &lt;li&gt;The registration table simply stores encrypted pseudonymous identifiers. There is a one-to-many relationship from patient to registrations.&lt;/li&gt;
  &lt;li&gt;A project represents a clinical service or research project. Future versions will include additional information such as a URL to an organisation or service homepage as well as service authentication credentials.&lt;/li&gt;
  &lt;li&gt;An episode stores a project-specific pseudonymous identifier and will store the patient’s explicit choices regarding the use of their data in that context. It will be here that a verifiable audit log is required to track changes in choice so that we can vouch that nothing has tampered with the transactions that have occurred at the episode level.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;This data model is working and is unit tested. An example of creating a patient and understand that they are part of a specific project is shown &lt;a href=&quot;https://github.com/wardle/openconsent/blob/master/src/test/java/com/eldrix/openconsent/model/TestPatients.java&quot;&gt;here, if you can understand java code&lt;/a&gt;. Essentially a patient is registered to a project and I show that we can find that registration subsequently.&lt;/p&gt;

&lt;p&gt;The encryption key is generated randomly. It is encrypted using a key derived from a digest of the patient’s password. The encryption key can only be decrypted with access to the patient’s password but this is never stored. The digest used to validate a patient’s password is stored but is calculated differently to the digest used as the key for the encryption key. The encryption key is used for encryption and decryption of sensitive information relating to that patient. By decrypting the registration information, the application can get a list of episode identifiers for that patient.&lt;/p&gt;

&lt;p&gt;I do need to add an encrypted global pseudonym that is not exposed to research projects and clinical services to allow data linkage once a patient’s account has been validated. More details of this are given below.&lt;/p&gt;

&lt;p&gt;The next steps will be to expose this functionality as a REST service. My plan for the eventual architecture is shown here with the unimplemented pieces in grey and the already implemented model in blue.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/openconsent/openconsent-plan.png&quot; alt=&quot;Openconsent Plan&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The following sections describe how the system works to track consent in a safe way.&lt;/p&gt;

&lt;h4 id=&quot;a-research-project&quot;&gt;A research project&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;A research project is registered with a project-specific consent form.&lt;sup&gt;&lt;a href=&quot;#consent-form&quot;&gt;b&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
  &lt;li&gt;A research project creates an episode using the patient’s details and so needs to know their details to pass in to generate a pseudonym.&lt;/li&gt;
  &lt;li&gt;If that project subsequently wants to know whether a patient they are seeing has consented, they can pass the patient’s identifier (e.g. NHS number) and date of birth and get any active episodes.&lt;/li&gt;
  &lt;li&gt;However, because openconsent understands that such a service is opt-in, it will only issue authorisation tokens if the episode has been validated by the patient explicitly.&lt;/li&gt;
  &lt;li&gt;If a patient has consented, then the project can submit the pseudonym to receive an &lt;a href=&quot;https://oauth.net/2/&quot;&gt;OAUTH2 token&lt;/a&gt;. OAUTH2 is a distributed authorisation framework which allows application to obtain limited access to a data repository. A verifiable audit log records the transaction using the pseudonym.&lt;/li&gt;
  &lt;li&gt;Should a patient’s consent be withdrawn, or not exist in the first place, then no data is returned. No further work is possible.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Validation of permission by the patient could occur in a variety of ways:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;when a member of the research team meets the patient and shows them a QR code that is readable by a mobile device application.&lt;/li&gt;
  &lt;li&gt;a QR code that links to a web application portal for the patient&lt;/li&gt;
  &lt;li&gt;manually typing in the project-specific pseudonym&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Once linked, a patient account stores the registration information in an encrypted format and can then find the episode information and alter their permissions within the episode.&lt;/p&gt;

&lt;p&gt;The data store would provide data linked only via the pseudonym preventing simple re-identification of patients.&lt;/p&gt;

&lt;h4 id=&quot;a-clinical-service&quot;&gt;A clinical service&lt;/h4&gt;

&lt;p&gt;A registered clinical service would expect to always have authorisation to patient data, but audit trails of information requested would still be recorded as above. Clinical users would authenticate with their clinical applications and those applications would themselves authenticate and become authorised to access clinical data, obtaining an OAUTH2 token to access the appropriate data.&lt;/p&gt;

&lt;p&gt;A clinical service would therefore create an episode using the patient’s information and no explicit consent is required for openconsent to issue authorisation tokens. However, there is a problem here. How can a patient remove their consent for this specific use of their data? There is no way an episode can identify the patient or indeed a registration entity corresponding to that episode as a result of the one-way link between a registration and an episode.&lt;/p&gt;

&lt;p&gt;I think that there are two options:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Iterate through all registered projects and calculate on-the-fly a pseudonym for each and look for matches within the episodes. This would work only if we store the information required to generate the pseudonym in the Patient entity. This is possible but may struggle to scale if there are many projects.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Add a global but private pseudonym that, once recorded acts to validate that the patient account is owned by the person we think. However, this private global pseudonym cannot be shared with individual services and is built from a recipe of immutable information about the patient using a different salt. Once the information used to built the pseudonym are validated, the global pseudonym can be recorded encrypted in the patient’s own account. This can then be used to link project-specific pseudonyms to a single record.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I consider option (2) to be preferable but will work to prove that in the proof-of-concept project.&lt;/p&gt;

&lt;p&gt;For option (2), the global pseudonym will also need to be stored, privately for an episode. Thus, for a validated patient account, the service can then find all episodes relating to them even though there is no corresponding registration. If a patient is not happy with the use of their data for that purpose, they can mark it as such. In the model, a registration is built to link the patient with the episode, and their new preferences are recorded in that episode with the change recorded in the verifiable log. From that point, service access will not be permitted.&lt;/p&gt;

&lt;p&gt;For opt-out services, most episodes will not be linked to from a registration entity except if a patient has explicitly opted-out. If the patient has done so, then the episode will have had the permissions changed.&lt;/p&gt;

&lt;h4 id=&quot;the-patient&quot;&gt;The patient&lt;/h4&gt;

&lt;p&gt;A patient should be able to login via their portal. From there, they can see their registered projects and services by decrypting a list of project-specific pseudonyms. In these, they can opt-in of research and opt-out for non-research clinical uses on a case-by-case basis.&lt;/p&gt;

&lt;p&gt;For research, a patient may engage with the research team or a project-specific application or generic sign-up application and link their account to the project. Essentially, in the data model, I create a registration entity that maps to the episode entity for that project and patient. A patient may then easily remove their consent at some point in the future, with any changes made to the episode and the transaction logged with the verifiable log.&lt;/p&gt;

&lt;p&gt;For clinical services, a patient would need to register to opt-out as discussed above.&lt;/p&gt;

&lt;h4 id=&quot;problems-and-requirements&quot;&gt;Problems and requirements&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;The software is a simple proof-of-concept at the moment and is incomplete. I need to:
    &lt;ul&gt;
      &lt;li&gt;integrate an OAUTH2 server. Can &lt;a href=&quot;https://oltu.apache.org&quot;&gt;Apache Oltu&lt;/a&gt; do this?&lt;/li&gt;
      &lt;li&gt;add REST endpoints. This is quite easy using LinkRest and standard JAX-RS.&lt;/li&gt;
      &lt;li&gt;link to a verifiable log. Needs evaluation. Plan for simple log that can replaced with proper verifiable version in future. I’d plan for the verifiable log to be on a remote service. Could I use &lt;a href=&quot;https://github.com/google/trillian&quot;&gt;Trillian&lt;/a&gt;?&lt;/li&gt;
      &lt;li&gt;build user interface components to expose the tools to the patient (although this would be a long-term aim).&lt;/li&gt;
      &lt;li&gt;build data repository wrappers to check for OAUTH2 tokens for permission to access.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Further questions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Is AES encryption good enough for encrypting the data fields within the patient record and the associated registrations? At the moment, this uses 128-bit keys, but it would be straightforward to increase the key length in production.&lt;/li&gt;
  &lt;li&gt;Can this be a distributed system? Probably. The software supporting the Patient - Registration can run on a separate service than the Episode - Project components, and there could be multiple latter services, essentially creating a registry of data registries?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Essentially, the design principles here are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;decoupling applications from data stores&lt;/li&gt;
  &lt;li&gt;put patients in charge of opt-in and opt-out for access to their data for different purposes&lt;/li&gt;
  &lt;li&gt;create a secure architecture using encryption and pseudonymous linkage, so we can offer guarantees about data governance while permitting large-scale access by third parties.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This is a project in development so thoughts and suggestions are most welcome!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;p&gt;&lt;a name=&quot;care-of-patients&quot;&gt;a&lt;/a&gt;: I originally wrote “to support the care of patients”, but that implies that it is care that is &lt;em&gt;done to&lt;/em&gt; patients rather than a partnership; the words we use to frame a problem potentially limit our ability to solve the real issue.&lt;/p&gt;

&lt;p&gt;&lt;a name=&quot;consent-form&quot;&gt;b&lt;/a&gt;: In the PatientCare EPR, I have an electronic consent system with specific items of consent mapped in an information model exposed via a REST service. An iPad application can use this to build a ResearchKit based consent form automatically and dynamically. The following video demonstrates this functionality in which I edit a consent form electronically and the change is seen in the ResearchKit based application, here running on an iPad.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/59tGM85zzlY&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;</content><author><name></name></author><summary type="html">Update: 8th April 2017. I have refined the data model in a subsequent post.</summary></entry><entry><title type="html">Test requesting</title><link href="https://www.wardle.org/clinical-informatics/2017/04/04/test-requesting.html" rel="alternate" type="text/html" title="Test requesting" /><published>2017-04-04T12:27:23+01:00</published><updated>2017-04-04T12:27:23+01:00</updated><id>https://www.wardle.org/clinical-informatics/2017/04/04/test-requesting</id><content type="html" xml:base="https://www.wardle.org/clinical-informatics/2017/04/04/test-requesting.html">&lt;p&gt;I discussed the importance of scope and framing in a &lt;a href=&quot;/clinical-design/2017/03/23/scope-framing-clinical-design.html&quot;&gt;recent blog post&lt;/a&gt; concluding that the framing and scope of the overall problem domain must be broad enough to model reality but that solutions must be broken-up into components each of limited scope.&lt;/p&gt;

&lt;p&gt;This is a natural conclusion from a domain-driven design approach in which the design of clinical systems begins with a deep understanding of the domain. An issue for clinicians and those who develop information systems is that there are domain concepts which are implicit and assumed; assumptions and heuristics and understanding built up over many years of working in clinical practice.&lt;/p&gt;

&lt;p&gt;An example are the processes and workflow in clinical practice. A development team can work on a system to allow users to request tests but until the scope of the problem is sufficiently broadened to include a model of clinical workflow, a solution risks causing a mismatch between reality and software. I touch on mismatches in my &lt;a href=&quot;https://www.dropbox.com/s/62sg71a19voxpts/cis_design.pdf?dl=0&quot;&gt;domain-driven clinical information system paper&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Experience and a sense of aesthetics are important. A clumsy model results in a clumsy user interface and user dissatisfaction, despite a long list of requirements which the design team have succeeding in delivering.&lt;/p&gt;

&lt;h4 id=&quot;the-current-system&quot;&gt;The current system&lt;/h4&gt;

&lt;p&gt;In Wales, we have a “Welsh Clinical Portal” application which is meant to turn into a complete solution for almost all healthcare staff under the banner of “Once for Wales”. However, it is already acknowledged that the system is not suitable for primary care or the emergency unit of organisations across Wales, or indeed, operating theatres or the community.&lt;/p&gt;

&lt;p&gt;I feel very strongly that user-facing applications should be process and workflow-driven, improving care and supporting care in specific clinical situations. However, to prevent duplication of effort, such applications such be &lt;em&gt;stupid&lt;/em&gt;. They should possess little or no logic but use functionality provided by a national platform to make sense of what they are trying to achieve. Our user-facing applications become simply thin wrappers around a service-orientated architecture as part of that platform. A user-interface may be &lt;em&gt;smart&lt;/em&gt; but only in it adapts in a smart way to what the user is doing.&lt;/p&gt;

&lt;p&gt;As I outlined previously:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;The current solution tries to be everything to everyone. It supports requesting tests for an arbitrary date, or set of dates. It is accessible only within the WCP application itself; its user interface, its functionality and the services it uses to implement its functionality are not available outside of WCP.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The main issues as I see it are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The current system supports only laboratory tests and different screens are planned to support requesting other tests such as radiology.&lt;/li&gt;
  &lt;li&gt;The core functionality should be available to other software via an application programming interface (API) which enforces business rules supporting the domain logic on which test requesting must depend.&lt;/li&gt;
  &lt;li&gt;A single user-interface may not be appropriate in all workflows.&lt;/li&gt;
  &lt;li&gt;A core default user interface should also be available to other software so that it may be embedded in different systems to suit different workflows.&lt;/li&gt;
  &lt;li&gt;There are problems with the existing user interface.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Should I focus on redesigning the user interface, or challenge the current architecture?&lt;/p&gt;

&lt;p&gt;I’ll go with the latter, although we can make the user interface much smarter as well.&lt;/p&gt;

&lt;h2 id=&quot;applying-domain-driven-design-in-test-requesting&quot;&gt;Applying domain-driven design in test requesting&lt;/h2&gt;

&lt;p&gt;I’m going to use a redesign of the test requesting workflow as an example of applying domain-driven design.&lt;/p&gt;

&lt;h3 id=&quot;explicit-rules-vs-implicit-assumptions&quot;&gt;Explicit rules vs. implicit assumptions&lt;/h3&gt;

&lt;p&gt;Business rules and assumptions are frequently overlooked when clinicians and designers meet. They contain implicit knowledge that is routine, mundane, automatic and most importantly, assumed. It is important to fully explore a problem domain and challenge implicit assumption in both workflow and process.&lt;/p&gt;

&lt;p&gt;In addition, these assumptions will vary; not just between different professions within healthcare but even within the same specialism. Indeed, I must admit to creating contradictory and inconsistent perspectives in my own clinical practice when creating my own EPR and realising my mistake only at the time of implementation.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;RULE ONE:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Examine and judge all assumptions; make the rules that drive your system(s) explicit.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;declarative-vs-imperative-systems&quot;&gt;Declarative vs. imperative systems&lt;/h3&gt;

&lt;p&gt;Declarative environments allows the rules and logic of a system to be expressed without describing the procedure that must be followed in order to apply that logic. This is very different to a procedural (or “imperative”) approach in which rules and logic are present by virtue of how they have been interpreted and turned into a sequence of commands by a programmer. In declarative programming, the logic and rules are explicit; in procedural programming, they are implicit.&lt;/p&gt;

&lt;p&gt;Non-programmers might assume that declarative programming must be the most common method to build software in the modern age, given that the rules and logic are expressed logically and explicitly. In fact, this is not the case, and the most commonly used programming languages today are procedural programming languages. There are a variety of reasons for this which are outside of the scope of this article.&lt;/p&gt;

&lt;p&gt;Complex business environments - and I very much include healthcare information technology - are frequently made up of many different systems all with different responsibilities and scope. Business rules can be distributed across systems making it difficult to understand how or why something unexpected has happened when a set of unusual circumstances come together and result in a critical incident. We want healthcare software to be deterministic; we want to prove that a system does what we say it does. It makes sense therefore to build in business rules management into the design of any clinical information system so that our software can leverage those business rules and adapt when those rules change in the future.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;RULE TWO:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Favour explicit rules written declaratively in the language of the business.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;architectural-design--aesthetics&quot;&gt;Architectural design / aesthetics&lt;/h3&gt;

&lt;p&gt;In Section 5 of &lt;a href=&quot;https://www.dropbox.com/s/62sg71a19voxpts/cis_design.pdf?dl=0&quot;&gt;Domain-driven design for clinical systems&lt;/a&gt;, I introduce a number of fundamental architectural decisions such as layering, the use of a service-orientated approach and model-view-controller designs. I will not repeat those here.&lt;/p&gt;

&lt;p&gt;I introduced this diagram in my blog post about &lt;a href=&quot;/clinical-design/2017/03/23/scope-framing-clinical-design.html&quot;&gt;scope and framing of clinical problems&lt;/a&gt;:
&lt;img src=&quot;/images/test-requesting.png&quot; alt=&quot;Test Requesting&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Importantly, this schematic emphasises the importance of breaking-up our test requesting solution into components representing those that face the user (our user interface) and those that face our other services (our business interfaces). Interfaces to the user fundamentally depend on the workflow that our clinical information system is meant to support. In addition, computing hardware changes frequently with new handheld devices and new ways of working, so it is important to ensure separation between user-facing applications and underlying business logic.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;RULE THREE:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Always design to support multiple user interfaces on multiple devices.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;This rule forces several important architectural decisions, particularly if one abides by the next rule as well:&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;RULE FOUR:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Don’t repeat yourself&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Critically, it means that all business logic must exist at the service-layer of your architecture and then your user-facing applications are &lt;em&gt;stupid&lt;/em&gt; in that they delegate all control logic to other services, but &lt;em&gt;smart&lt;/em&gt; in the way that they fit in and support clinical workflow.&lt;/p&gt;

&lt;h3 id=&quot;test-requesting&quot;&gt;Test requesting&lt;/h3&gt;

&lt;p&gt;So for test requesting, our user interface via a web browser might look like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/test-request/landing-page.png&quot; alt=&quot;Landing Page&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Generic test requesting, not just for laboratory tests. Do you expect me to use a different screen to request different types of tests such as radiology? We extend the frame of our overall problem.&lt;/li&gt;
  &lt;li&gt;No modal dialogs but a smart user interface that reacts to our keypresses and mouse clicks, adapting itself appropriately. Why make the user click a button to send the request and then show them a modal alert? Instead, make the button inactive and tell them what needs to be done to make it active.&lt;/li&gt;
  &lt;li&gt;If additional information is required, then adaptive forms appear to request that information:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/test-request/adding-free-text.png&quot; alt=&quot;Adding Free Text&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here the user can see what needs to be done to complete the form: enter information about thyroid function and then enter their password:&lt;/p&gt;

&lt;p&gt;To make a test a favourite, we allow users to toggle the heart icon. To choose from our favourites, we do this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/test-request/adding-favourites.png&quot; alt=&quot;Adding Favourites&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And finally, when the request is ready to be sent:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/test-request/ready-for-request.png&quot; alt=&quot;Ready For Request&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The information about thyroid status and whether the patient takes thyroxine should really be completed automatically from what we already know about the patient. For now however, WCP doesn’t have this information readily available. In our design however, we must consider how information could be auto-completed.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;RULE FIVE:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Plan for the future.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;what-do-we-need&quot;&gt;What do we need?&lt;/h3&gt;

&lt;p&gt;Architecturally, we need:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;A service to provide fast full-text searching for tests.&lt;/li&gt;
  &lt;li&gt;A test handbook service - a declarative repository of investigations and the rules that manage those investigations. This test handbook must also add support for explicitly declaring additional information required at the point-of-request as well as hooks to allow external services to help manage the requesting workflow for that test. This test handbook service conceptually is a business rules engine, declaring exactly what is permitted and when.&lt;/li&gt;
  &lt;li&gt;As a result, a request-workflow service must be designed to handle all tests in a generic way but, for certain investigations, a more custom service URL can be specified in which more complex logic can be performed in an imperative manner.&lt;/li&gt;
  &lt;li&gt;Each request-workflow service must consider how access to structured electronic health record information might support their use. For example, logic supporting thyroid function may auto-complete the “taking thyroxine” pop-up by simply looking at a FHIR representation of the current medication list at the time of the test.&lt;/li&gt;
  &lt;li&gt;Services to provide support for the lists of locations and clinicians bound to the specific workflow and currently logged-in user.&lt;/li&gt;
  &lt;li&gt;A service to register and list favourite investigations for individual clinicians and groups of clinicians.&lt;/li&gt;
  &lt;li&gt;Underlying services to actually action the test request.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Almost all of this functionality is already available, but is available only to the existing application.&lt;/p&gt;

&lt;h3 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h3&gt;

&lt;p&gt;In conclusion, I have widened the scope of the overall solution to include all investigations and not only laboratory tests, but modularised the architecture and narrowed the scope of these individual components.&lt;/p&gt;

&lt;p&gt;Mark&lt;/p&gt;</content><author><name></name></author><summary type="html">I discussed the importance of scope and framing in a recent blog post concluding that the framing and scope of the overall problem domain must be broad enough to model reality but that solutions must be broken-up into components each of limited scope.</summary></entry><entry><title type="html">PatientCare videos</title><link href="https://www.wardle.org/patientcare/2017/03/26/patientcare-old-videos.html" rel="alternate" type="text/html" title="PatientCare videos" /><published>2017-03-26T22:20:10+01:00</published><updated>2017-03-26T22:20:10+01:00</updated><id>https://www.wardle.org/patientcare/2017/03/26/patientcare-old-videos</id><content type="html" xml:base="https://www.wardle.org/patientcare/2017/03/26/patientcare-old-videos.html">&lt;p&gt;PatientCare is an electronic patient record (EPR) system that supports the care of over 20,000 patients and records over 3000 clinical encounters every month.&lt;/p&gt;

&lt;p&gt;I need to create some videos to demonstrate the range of functionality, but for now, I’ve included some old videos:&lt;/p&gt;

&lt;h4 id=&quot;the-motor-neurone-disease-module&quot;&gt;The motor neurone disease module&lt;/h4&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/DGvCzfhOoN0&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;clinic-based-ipad-application---healthcontact&quot;&gt;Clinic-based iPad application - HealthContact&lt;/h4&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/GTo0fGHgoIA&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;We’ve trialled this in the outpatient clinic successfully. See &lt;a href=&quot;/about#iPadParkinson&quot;&gt;our published abstract&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;medication-entry&quot;&gt;Medication entry&lt;/h4&gt;

&lt;p&gt;These videos show the real-time mapping of user entered text to SNOMED-CT codes from the DM&amp;amp;D (dictionary of medicines and devices). You’ll notice the parsing of doses and the calculation of unchanged, started and stopped drugs. This makes it very quick in the outpatient clinic.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/3tRyjJk-71M&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/F2LSHpdCPvo&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;iphone-application-for-communication&quot;&gt;iPhone application for communication&lt;/h4&gt;

&lt;p&gt;This was a simple iOS application that used the PatientCare EPR to handle user communication linked to the patient record. Unfortunately, I did not successfully convince my organisation to allow use of the wifi network, so I never deployed this.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/1Lej6CMZZkY&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;</content><author><name></name></author><summary type="html">PatientCare is an electronic patient record (EPR) system that supports the care of over 20,000 patients and records over 3000 clinical encounters every month.</summary></entry><entry><title type="html">The importance of scope and framing in clinical design</title><link href="https://www.wardle.org/clinical-design/2017/03/23/scope-framing-clinical-design.html" rel="alternate" type="text/html" title="The importance of scope and framing in clinical design" /><published>2017-03-23T10:01:01+00:00</published><updated>2017-03-23T10:01:01+00:00</updated><id>https://www.wardle.org/clinical-design/2017/03/23/scope-framing-clinical-design</id><content type="html" xml:base="https://www.wardle.org/clinical-design/2017/03/23/scope-framing-clinical-design.html">&lt;h4 id=&quot;scope&quot;&gt;Scope&lt;/h4&gt;
&lt;p&gt;: defines the requirements and objectives and what will be delivered from a project.&lt;/p&gt;

&lt;h4 id=&quot;framing&quot;&gt;Framing&lt;/h4&gt;
&lt;p&gt;: a way of structuring or presenting a problem or issue&lt;/p&gt;

&lt;h1 id=&quot;clinical-design&quot;&gt;Clinical design&lt;/h1&gt;

&lt;p&gt;Scope and framing are critical in designing valuable health information technology.&lt;/p&gt;

&lt;p&gt;If you ask for a system to request laboratory tests electronically then that’s what you’ll get.&lt;/p&gt;

&lt;p&gt;If your initial framing of the problem is wrong, you won’t get a solution that solves the true user problem. The user problem is defined by the user, with support to understand and explore the problem in its entirety.&lt;/p&gt;

&lt;p&gt;When one creates a model - whether the model represents a train, a new building or software - there is a balance between over-complexity and over-simplification. As I wrote in my &lt;a href=&quot;/clinical-informatics/2017/02/03/domain-driven-design.html&quot;&gt;‘Domain-driven design’ document&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;A model is an abstraction of the real-world distilling knowledge into core concepts and processes. A model is a careful balance between complexity and over- simplification with models that are too complex providing brittle abstractions which are poorly generalisable and models that are too simple not supporting all of the demands placed upon it in real-life clinical scenarios.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;See the &lt;a href=&quot;https://www.dropbox.com/s/62sg71a19voxpts/cis_design.pdf?dl=0&quot;&gt;full document&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;user-centred-design&quot;&gt;User-centred design&lt;/h1&gt;

&lt;p&gt;Clinical information systems should solve real-life user problems. The user may be the patient, a health professional, a member of the laboratory staff or anyone else involved either directly or indirectly in patient care. Information systems are therefore inherently bound to process and workflow; to be more specific, the processes and workflows for that user or those groups of users.&lt;/p&gt;

&lt;p&gt;Our aim, always, is to create solutions that valuably support the care of patients but while we must not lose sight of this overarching aim, an effective information technology strategy must be explicit in how it will effect change to reach those aims. It is my opinion that we spend too little time understanding and refining the problems we are trying to solve resulting in poorly framed problems with ill-defined scope.&lt;/p&gt;

&lt;p&gt;As I wrote in my &lt;a href=&quot;/clinical-informatics/2017/03/15/once-for-wales.html&quot;&gt;“Once for Wales” speech&lt;/a&gt; in which I pitched for interoperability and data standards for NHS Wales:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;It is almost always the case that when building complex solutions to real-life problems, no-one person can conceive of all of the problems in one go. The natural solution to such complexity is to break-down a problem into manageable chunks. These chunks, much like “lego bricks”, can be joined together to form something greater than the sum of the parts. Importantly, it is more likely that we can vouch that a system is deterministic.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We need to spend time working on the problems we are trying to solve and, break them apart into manageable chunks. Such a process requires skill and experience spanning knowledge of both the domain &lt;em&gt;and&lt;/em&gt; information technology together with a large amount of pragmatism to &lt;em&gt;get things done&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Importantly, core design principles such as using a &lt;a href=&quot;https://www.dropbox.com/s/62sg71a19voxpts/cis_design.pdf?dl=0&quot;&gt;domain-driven design to build a layered architecture&lt;/a&gt; &lt;em&gt;protect&lt;/em&gt; those involved and force an approach which, while not impervious to changes in workflow and process, can more easily adapt to those changes than a design built as a monolith.&lt;/p&gt;

&lt;h1 id=&quot;test-requesting&quot;&gt;Test requesting&lt;/h1&gt;

&lt;p&gt;We currently have a working test requesting module within NHS Wales’ &lt;em&gt;Welsh Clinical Portal&lt;/em&gt;  (WCP) software for requesting laboratory tests. Essentially, one navigates to a patient’s record and selects REQUEST-&amp;gt;Laboratory test.&lt;/p&gt;

&lt;p&gt;On many levels, this is a workable solution to the problem as framed; “allow clinical staff to request laboratory investigations”. The design team, given that brief, designed a multi-page form that allowed that functionality. There are some minor glitches in the user interface, but behind-the-scenes, there is considerable work in dealing with different laboratories and actually performing the test request.&lt;/p&gt;

&lt;p&gt;The team should have visited a variety of care settings in which tests are requested and arrived at the following conclusions and questions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;In many settings, laboratory tests are requested at the same time as other tests, such as radiology tests. Should the solution work in a more generic way to suit this workflow? How can the life of a clinician sitting in an outpatient clinic be improved? How can we create solutions that work better than the paper systems?&lt;/li&gt;
  &lt;li&gt;In many settings, a health professional is caring for a number of patients at the same time. How can we support the life of a junior doctor when trying to manage all of their inpatients?&lt;/li&gt;
  &lt;li&gt;In many situations, a request for a test is prompted by seeing a result. Should we support requesting tests from the “results” page when we see something that needs acting upon?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I’d like to crowdsource the framing of our problem. Are we only requesting laboratory investigations here or will the same system work for radiology? Can we expand our scope by reframing our problem? What about the future?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;What about routine monitoring according to protocol, for patients on certain drugs? My PatientCare EPR has this information, and given the right APIs, it could monitor those patients and request tests semi-autonomously. Would that functionality form part of the test requesting module within WCP or be separate?&lt;/li&gt;
  &lt;li&gt;We want to implement care plans that can be activated either manually or automatically for groups of patients. For example, a liver or renal failure patient may have a standard regime of investigations performed at regular intervals for monitoring. How can we support this?&lt;/li&gt;
  &lt;li&gt;What about other suggestions for clinical staff based on the information-at-hand, perhaps using machine-learning?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;And what about interaction with other systems?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;How is this going to work when the health professional filling in the request is going to take the blood and send it to the laboratory themselves? How is this going to work when the blood sampling will be done by a phlebotomist?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Finally what is in scope here? Do we need to design all of this functionality right away or can it evolve iteratively? Are there natural ‘fault lines’ which guide us as to &lt;em&gt;how&lt;/em&gt; to break this up into manageable parts?&lt;/p&gt;

&lt;h3 id=&quot;the-current-architecture-a-monolith&quot;&gt;The current architecture: a monolith&lt;/h3&gt;

&lt;p&gt;The current solution tries to be everything to everyone. It supports requesting tests for an arbitrary date, or set of dates. It is accessible only within the WCP application itself; its user interface, its functionality and the services it uses to implement its functionality are not available outside of WCP.&lt;/p&gt;

&lt;p&gt;Advocates of a monolithic approach say that standardisation of user interfaces makes it easier for users, reduces need for training and avoids duplication. I think this is wrong. I will vouch that you can operate an email client, whether it is web-based, runs on a mobile device or a desktop computer, from any vendor since email was invented because the nouns and verbs are the same. You might have a ‘draft email’ waiting to be ‘sent’, an ‘outbox’, an ‘inbox’, ‘folders’, ‘addresses’ in a ‘to’ field etc.&lt;/p&gt;

&lt;p&gt;Standardisation should be at the level of the nouns we use and the verbs we use to operate on those nouns. Thus we develop or adopt standardised information models in which our data and the processes/workflow in which we work are modelled.&lt;/p&gt;

&lt;p&gt;In addition, a monolithic or “product”-based approach makes it difficult to adapt to change. If we want to start work on extending the scope to include some of the functionality outlined above, we’ll need to make considerable changes to the WCP application. But we must be careful; every change that we make, every button we add, adds complexity to an already overwhelming user interface. To support every new feature, we are potentially extending our list of responsibilities and scope.&lt;/p&gt;

&lt;p&gt;‘Scope creep’ is the term used to describe continuous expansion of a project’s scope, usually a result of a variety of factors including poor initial framing of the problem to be solved, poor initial scoping and lack of flexibility and versatility in any resulting solution.&lt;/p&gt;

&lt;h3 id=&quot;adopting-a-service-orientated-architecture&quot;&gt;Adopting a service-orientated architecture&lt;/h3&gt;

&lt;p&gt;What if we pick apart the problem we are trying to solve?&lt;/p&gt;

&lt;p&gt;The diagram shows an abstract view of what we are trying to solve with test requesting:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/test-requesting.png&quot; alt=&quot;Test Requesting&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The test requesting service wraps an integration layer to provide generic test requesting. Whether a test is requested from a laboratory or another service, a separation between laboratory tests and other types of investigation tests is an artefact of implementation of health services; abstractly, a test request is a test request irrespective of which service will perform the test.&lt;/p&gt;

&lt;p&gt;However, it is likely that different tests will require different information to be provided at the time of request. Rather than embedding this important business logic in an application, this architecture forces an approach which explicitly recognises this business requirement and models it appropriately. There is an explicit design to ensure dynamic runtime configuration can modify the behaviour of the ‘system’.&lt;/p&gt;

&lt;p&gt;A formal contract between the responsibilities and scope of each component must be defined. While the scope of the overall solution may change to meet new requirements, a modular layered approach means that scope creep of individual components should be minimal.&lt;/p&gt;

&lt;p&gt;Applications, such as the web-based front-end application server or applications running on mobile devices, do not directly use a requesting service but use a service provided at the application layer. This layer provides further abstractions and while it will pass on requests to the test request service, it will have responsibility to apply business rules and domain logic such as audit trails and permissions. Those rules may be recorded declaratively in a rules engine rather than hard-coded at the domain layer allowing considerable flexibility in the future to add or change business rules to suit business need.&lt;/p&gt;

&lt;p&gt;The core requesting service does not need to have responsibility for domain logic, but has as its only responsibility to make the request against the end-point laboratory service(s).&lt;/p&gt;

&lt;h3 id=&quot;designing-for-the-future&quot;&gt;Designing for the future&lt;/h3&gt;

&lt;p&gt;With such an architecture, we have considerable flexibility to suit future requirements. If we wish to implement decision support, this could be performed at the domain logic layer and so decision support would be available to all client applications. At project initiation, we may have little or no decision support but our domain layer service must be designed with the hooks to enable this in the future. Over time, should more sophisticated decision support be available, client applications need not know - it is not their responsibility - because our systems are flexible enough to support this new functionality.&lt;/p&gt;

&lt;h3 id=&quot;the-final-design&quot;&gt;The final design&lt;/h3&gt;

&lt;p&gt;Our final design for redefining the user interface of test requesting within WCP becomes much simpler once there is an underlying robust architectural platform.&lt;/p&gt;

&lt;p&gt;It is my opinion that no single user interface will suit all use-cases. I am not concerned if there are multiple versions of the user interface as long as each version fits into the workflow and processes of a specific clinical domain. For instance, it is a long time since I was a junior doctor and I’d want to sit down with a team of them to make the most intuitive and best system to support their processes as possible. Our user interface and logic would be only a thin wrapper around our more complex architecture, but I’d envisage test requesting as part of a jobbing ward round, inpatient list and communication application. The nouns and verbs, the domain-model of the test requesting lifecycle would be standardised across the applications, not the user interface.&lt;/p&gt;

&lt;p&gt;Similarly, what I need in a busy outpatient clinic is a somewhat different. Now it may make sense to share a lot of user interface code, or indeed, with today’s responsive technologies, use the same user interface on the same platform. However, this would be a decision made for pragmatic business purposes if the shared user facing components were appropriate in those different clinical contexts. Such a decision would not be made because we are slavishly following a directive to create systems that are &lt;a href=&quot;/clinical-informatics/2017/03/15/once-for-wales.html&quot;&gt;“Once-for-Wales”&lt;/a&gt; but different devices may need different user interface components to suit their form factor and critically, the workflow in which they are to be used.&lt;/p&gt;

&lt;h3 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Frame the problem appropriately.&lt;/li&gt;
  &lt;li&gt;Get early involvement of groups of disparate domain, information technology and usability experts.&lt;/li&gt;
  &lt;li&gt;Extend the scope of the overall problem appropriately, designing in versatility to make solutions future-proof.&lt;/li&gt;
  &lt;li&gt;Limit scope and responsibility of individual components: work to break-up a problem and solution into manageable parts and enforce limitations on responsibility and scope for those component parts.&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><summary type="html">Scope : defines the requirements and objectives and what will be delivered from a project.</summary></entry><entry><title type="html">An update on Merkle trees</title><link href="https://www.wardle.org/merkle-trees/2017/03/20/merkle-trees.html" rel="alternate" type="text/html" title="An update on Merkle trees" /><published>2017-03-20T06:53:48+00:00</published><updated>2017-03-20T06:53:48+00:00</updated><id>https://www.wardle.org/merkle-trees/2017/03/20/merkle-trees</id><content type="html" xml:base="https://www.wardle.org/merkle-trees/2017/03/20/merkle-trees.html">&lt;p&gt;In a previous post, I referenced Merkle trees in relation to the creation of a &lt;a href=&quot;/clinical-informatics/2017/03/09/google-information.html&quot;&gt;verifiable audit log&lt;/a&gt;. I broke a cardinal rule by discussing something for which I (then) had little knowledge.&lt;/p&gt;

&lt;p&gt;In my defence, the technology is rather clever so I don’t regret writing about it. However, I’ve had some help correcting my misunderstandings, so I thought it would be prudent to write down what I’ve learned. Any remaining errors are mine.&lt;/p&gt;

&lt;p&gt;An introductory article on this technology can be found on the &lt;a href=&quot;https://gdstechnology.blog.gov.uk/2015/10/13/guaranteeing-the-integrity-of-a-register/&quot;&gt;Government digital service’s site&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;merkle-trees-are-more-interesting-than-i-thought&quot;&gt;Merkle trees are more interesting than I thought&lt;/h4&gt;

&lt;p&gt;I originally wrote:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;It uses a nested tree design called Merkle trees but this is simply an optimisation to limit the computational requirements whenever data is added.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It turns out that the use of Merkle trees is more than simply an optimisation of a hash list, although that is a very important benefit. The tree structure allows rapid proof that an entry is in a log by simply checking a branch of nodes (log(n)), rather than all nodes, and so the whole data structure can be verified without transferring the whole contents. This isn’t just an optimisation but permits validation of databases of potentially unbounded size.&lt;/p&gt;

&lt;p&gt;Similarly, this same can be said for replicating data in a distributed system. For example, if we are replicating data then we can start with the root of the tree (a list of one hash value) and compare the hashes. If there are no differences, the replication can stop, but otherwise, the process repeats with the child nodes in a recursive manner.&lt;/p&gt;

&lt;p&gt;In addition, a Merkle tree can be used as a key-value store. A ‘map’ in programmer’s terms is a data structure in which a value can be stored associated with a key; such a structure is called an associative array. Usually, to avoid having to iterate through all entries in order to find the one that matches the key, a hash function is used to assign a key into (hopefully) a unique bucket. This ‘hashmap’ makes it much quicker to find the value for a particular key.&lt;/p&gt;

&lt;p&gt;When creating an append-only log, a Merkle tree is “dense”; there are no gaps and the tree is populated conceptually from left-to-right at successive indices and each hash is a hash of the child nodes.&lt;/p&gt;

&lt;p&gt;In “map” mode, instead of adding entries left-to-right, entries are added using the hash as the index. Thus, the tree is populated piecemeal. Now if you’ve been reading carefully, you might then assume that a Merkle tree in map mode would be impossible to implement, as there would be 2^256 buckets and an enormous tree of hashes to calculate and validate. However, almost all entries are empty. This is why this type of Merkle tree is termed a “sparse Merkle tree”, and we can derive identical hashes for most branches within the tree. Thus, a practical implementation becomes feasible. In the same way as a verifiable log, a map may be synchronised by recursively comparing hashes from the top down, stopping prematurely at a level if the hashes match.&lt;/p&gt;

&lt;p&gt;It is possible to combine the benefits of a key-value store and log when one uses a verifiable log to store the transactions which occur on the key-value store, in a so-called “verifiable log-backed map”. A primer on these verifiable data structures is available as &lt;a href=&quot;https://github.com/google/trillian/blob/master/docs/VerifiableDataStructures.pdf&quot;&gt;part of Google’s own implementation, Trillian&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;deepmind-healths-verifiable-audit-log&quot;&gt;Deepmind Health’s verifiable audit log&lt;/h4&gt;

&lt;p&gt;I also wrote:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Presently, I understand that this is designed to be a centralised record. Such centralisation means that potentially, whoever controls the ledger can change the ledger, simply by re-computing the hashes of the data to reflect the change. Computationally, this may be inefficient, but the verifiable log only becomes verifiable when the ledger is held by a trusted party. For the Deepmind collaboration, I would imagine the NHS organisation holds the ledger while Google writes to it.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This isn’t quite true either.&lt;/p&gt;

&lt;p&gt;Importantly, the log itself can potentially be held by a third-party entity such as Deepmind but in order to be verifiable, the NHS organisation needs to monitor and periodically verify that no-one has tampered with the log. This means that there needs to be a trusted infrastructure which partner organisations may use; after all, a log helps our cause only if someone is actually checking it!&lt;/p&gt;

&lt;p&gt;But how does one prevent a ‘nefarious’ organisation making use of data inappropriately simply by not logging the data access in the first place? Such an issue emphasises the importance of non-technical factors in obtaining and maintaining trust in relation to sensitive information. Is it sufficient to perform code review and audit in order to create trust? Perhaps.&lt;/p&gt;

&lt;p&gt;I am interested in promoting technical mechanisms which can guarantee that data access is logged appropriately and I suspect that a combination of technical and non-technical measures will be required. I have discussed these measures in a &lt;a href=&quot;/information-governance/2017/03/19/information-governance.html&quot;&gt;previous blog post on information governance and innovation&lt;/a&gt;.&lt;/p&gt;</content><author><name></name></author><summary type="html">In a previous post, I referenced Merkle trees in relation to the creation of a verifiable audit log. I broke a cardinal rule by discussing something for which I (then) had little knowledge.</summary></entry><entry><title type="html">Balancing information governance and innovation in the NHS</title><link href="https://www.wardle.org/information-governance/2017/03/19/information-governance.html" rel="alternate" type="text/html" title="Balancing information governance and innovation in the NHS" /><published>2017-03-19T21:28:45+00:00</published><updated>2017-03-19T21:28:45+00:00</updated><id>https://www.wardle.org/information-governance/2017/03/19/information-governance</id><content type="html" xml:base="https://www.wardle.org/information-governance/2017/03/19/information-governance.html">&lt;p&gt;“Google’s Deepmind made inexcusable errors handling UK health data”, was reported on 16th March 2017 in an article published in the journal “Health and Technology” by Julia Powles and Hal Hodson. The article is &lt;a href=&quot;https://link.springer.com/article/10.1007%2Fs12553-017-0179-1?wt_mc=Affiliate.CommissionJunction.3.EPR1089.DeepLink&amp;amp;utm_medium=affiliate&amp;amp;utm_source=commission_junction&amp;amp;utm_campaign=3_nsn6445_deeplink&amp;amp;utm_content=deeplink&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I don’t agree with most of their conclusions and there are some factual errors. One example is that they suggest that because the application is used in the monitoring and treatment of acute kidney injury (AKI), that access to data on patients not identified as having AKI is inappropriate and should need explicit patient consent. The error here is obvious to a practising clinician: namely, one cannot monitor and identify AKI without monitoring the renal function of all patients. They suggest that patient data should be shared only for patients who have had a “gateway blood test that is prerequisite for AKI diagnosis”. Again, a renal function test (commonly called renal profile or urea and electrolytes), is one of the (if not the) most common blood test performed in hospitals and certainly none of my patients have escaped having this blood test! In addition, the absence of a previous test may itself be a signal potentially of use in future implementations of AKI alerts; an absence of data due to a process that deliberately withholds such data may result in systems to support clinical care that are less valuable than systems having access to a complete set of data.&lt;/p&gt;

&lt;p&gt;My blog isn’t the right place for a detailed review of this article, but one positive conclusion is that we need to have a conversation about health data and the potential benefits and pitfalls of sharing. I’ve referred to the &lt;a href=&quot;/clinical-informatics/2017/03/09/google-information.html&quot;&gt;care.data fiasco in a previous blog post&lt;/a&gt; and, speaking in my role as a full-time clinician, we need to avoid any further controversy.&lt;/p&gt;

&lt;h4 id=&quot;information-technology-in-healthcare&quot;&gt;Information technology in healthcare&lt;/h4&gt;

&lt;p&gt;Are there any benefits to the more effective use of information technology in healthcare?&lt;/p&gt;

&lt;p&gt;In my opinion, very much so!&lt;/p&gt;

&lt;p&gt;Many of my patients will give an account of information not being available at the point-of-care, complicating their care and resulting in frequently needless duplication of care. From a personal point of view, I worry about starting drugs such as methotrexate, azathioprine and mycophenolate as these treatments need ongoing monitoring with checks of renal function, blood counts and liver function on a regular basis. You may be surprised to hear that there are no systems in place to ensure that this core work is performed. I don’t even get results sent to me, so I have to remember to login to my computer and check the results manually. Will I make a mistake? Definitely. Many specialties which use these drugs more frequently than my own (neurology) have a dedicated specialist nurse whose responsibilities include monitoring these bloods. But why have a human doing a job that a computer can do more reliably?&lt;/p&gt;

&lt;h4 id=&quot;driving-off-road-vs-taking-the-train&quot;&gt;Driving off-road vs. taking the train&lt;/h4&gt;

&lt;p&gt;My day job is looking after patients with neurological diseases such as epilepsy, multiple sclerosis, Parkinson’s disease and motor neurone disease.&lt;/p&gt;

&lt;p&gt;I have frequently compared the process of my work to “driving off-road” - travelling in uncharted territory - in order to &lt;em&gt;get routine things done&lt;/em&gt;. Yet I find myself having to do this again and again when in fact, most of what I do should be a case of “taking the train” -  medical care on rails, automatic, on-time and efficient.&lt;/p&gt;

&lt;p&gt;My colleagues and I will always need to “go off-road”, but this should be the exception and not the rule; importantly, it frees us him to concentrate on those patients in which we truly do need to go into uncharted territory. We therefore need tools that bring together the right information at the right time, but make logical inferences from those data in order to improve patient care.&lt;/p&gt;

&lt;h4 id=&quot;technology-and-medicine-on-rails&quot;&gt;Technology and medicine-on-rails&lt;/h4&gt;

&lt;p&gt;In summary therefore, I want most of my work to happen “on rails” and, like many of my colleagues, have become frustrated with the agonisingly slow introduction of technology into healthcare. There are already many companies providing solutions in use in community and hospital services but I am worried. It is increasingly difficult for small and medium enterprises to enter the market and ongoing consolidation has resulted in  very large companies providing enterprise-wide organisational-bound applications such as Cerner’s Millenium and Epic. The &lt;a href=&quot;https://www.gov.uk/government/publications/using-information-technology-to-improve-the-nhs&quot;&gt;Wachter report&lt;/a&gt; is an excellent blueprint for the future of IT within NHS England but like others, I have noted that the approach has a focus on secondary care services, will result in a small number of very large vendors monopolising the market and doesn’t really cover community and social care.&lt;/p&gt;

&lt;p&gt;In addition, a focus on large single-supplier products for each organisation results in a national architecture that will have a natural tendency to use a health information exchange as outlined in “Section 5.14 Are there exceptions to the use of a layered architecture?” of my &lt;a href=&quot;https://www.dropbox.com/s/62sg71a19voxpts/cis_design.pdf?dl=0&quot;&gt;Domain-driven design document for clinical information systems&lt;/a&gt;. Instead, I want an influx of new vendors, able to access data in a safe and controlled manner, using an open healthcare platform, to add value and benefit to clinicians and, by extension, to patients themselves.&lt;/p&gt;

&lt;p&gt;The logical questions that arise from this are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;how do we permit the adoption of small, well-defined applications within the health enterprise in a safe manner?&lt;/li&gt;
  &lt;li&gt;how do we permit access to large-scale aggregated health data in a way that benefits both individual patients for their direct care, and groups of patients at a population-level?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For example, if I wanted to introduce a small, well-defined application that would a) identify my patients on methotrexate, b) monitor their bloods for me, c) request their blood tests at the right time, if they haven’t already been done and d) alert me when they don’t have their bloods or they have a blood dyscrasia or some other change which merits my attention, then how could I do this within the current NHS infrastructure?&lt;/p&gt;

&lt;p&gt;For example, if a large commercial entity with expertise in artificial intelligence wanted to add value by monitoring a cohort of patients automatically to identify acute kidney injury, then how can this be done that satisfies both regulatory requirements and defends against public concern?&lt;/p&gt;

&lt;h1 id=&quot;the-case-for-pseudonymisation&quot;&gt;The case for pseudonymisation&lt;/h1&gt;

&lt;p&gt;Pseudonymisation is a process in which identifying data relating to an individual is replaced with an identifier. A commonly used method of pseudonymisation in healthcare is to create a pseudonym using a recipe based on fixed unchanging information about a patient such as a national identifier, a date of birth and country of birth. This uses an important property of a hash function to generate a fixed-length digest of a variably sized input; it is mathematically a one-way process. If you give me the input then I will always obtain the same digest &lt;em&gt;but&lt;/em&gt;, given a digest, I cannot determine the input.&lt;/p&gt;

&lt;p&gt;Now that last statement is not quite true, but brute-force attacks on hash functions are outside of the scope of this blog post, and, as long as one uses an additional salt (a fixed input parameter used together with other input parameters), one can avoid pre-calculated lookup table attacks.&lt;/p&gt;

&lt;p&gt;For example, one might generate a string such as “WIBBLE-111111111-2000-01-01-BIRMINGHAM” (a salt, the NHS number, the date of birth, the city of birth), and then use a SHA-256 hash to generate a unique digest.&lt;/p&gt;

&lt;p&gt;Pseudonymisation is different to anonymisation in which all identifiable information is removed. With pseudonymisation, it is possible to subsequently re-identify an individual. If an “attacker” knows the recipe for building the pseudonym and the salt, then they too can generate the pseudonym independently and subsequently use that pseudonym to link to data about that individual.&lt;/p&gt;

&lt;p&gt;Of course, if an “attacker” knows the recipe and the salt (together acting as a shared secret) and the individual’s information already, then one might assume that they are permitted to look-up information relating to that individual.&lt;/p&gt;

&lt;p&gt;Importantly, a different pseudonym can be calculated depending on what we are trying to achieve and to which other data our data need to be linked.&lt;/p&gt;

&lt;h4 id=&quot;healthcare-data-on-a-need-to-know-basis&quot;&gt;Healthcare data on a need-to-know basis&lt;/h4&gt;

&lt;p&gt;This figure demonstrates how a trusted pseudonymisation service can act as an intermediary between an NHS organisation and trusted third parties.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/pseudonym-audit-log.png&quot; alt=&quot;Distributed consent&quot; class=&quot;img-responsive&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here, the mobile devices are, without doubt, involved in direct clinical care. For that reason, they may directly interact with trusted organisational systems, supporting the management of patients. Importantly, they act as a proxy for a clinical user, supporting authentication and authorisation and then allowing that user to navigate health information as required.&lt;/p&gt;

&lt;p&gt;However, we would like to make use of health information to track patients with acute kidney injury. Instead of transferring patient identifiable information directly, we generate a project-specific pseudonym for this purpose only. With this identifier, a variety of information can be shared with the “open intermediary service”.&lt;/p&gt;

&lt;p&gt;Third-party analytics cannot re-identify patient data but can use health data to support clinical processes. Importantly, they can push information back to the trusted intermediary again linked to the individual using the provided pseudonym&lt;/p&gt;

&lt;p&gt;It is only within the NHS organisation that software can link the pseudonym-linked data with the identifiable information. The mobile application for example, can generate a pseudonym dynamically and request information from a third-party without giving away any information as to who or why the information is required. In addition, a third-party may generate an alert linked to a pseudonym and an NHS hosted service can re-identify the data.&lt;/p&gt;

&lt;p&gt;In addition, any third-party analytics must obtain healthcare data from the trusted open intermediary which contains only pseudonymised information. As part of a request for information, the intermediary may use a verifiable append-only audit log to record that the request has taken place. Once again, only software running within the NHS can identify to whom an audit log refers and thus, this information can be shared with both the patient and the host organisation. A third-party regulator can act to routinely verify that audit logs within the open intermediary service have not been subject to tampering.&lt;/p&gt;

&lt;h4 id=&quot;scaling&quot;&gt;Scaling&lt;/h4&gt;

&lt;p&gt;Using this system, it becomes possible for many different projects to use patient data without needing to handle patient identifiable information. Importantly, with a different pseudonym used for only a specific purpose, it is not possible for any individual project to link to data that has used a different pseudonym for a different purpose.&lt;/p&gt;

&lt;p&gt;If there were a centralised NHS-hosted service that recorded participation in projects, whether for direct clinical care or for research, then only that service could generate the required pseudonyms in order to re-identify or link data from disparate systems. In addition, patients themselves could control to which projects they are happy to share data.&lt;/p&gt;

&lt;p&gt;For my methotrexate monitoring application, we would need to identify all patients on methotrexate as well as look at their laboratory investigations. For this, we need medication histories as well as renal and liver function tests together with full blood count results. It is conceivable that this clinical application could easily be regarded as direct clinical care and so use a global pseudonym and share information with other applications. However, it would be possible to generate a project-specific pseudonym and use that together with the required clinical data for analysis by a third-party.&lt;/p&gt;

&lt;p&gt;Complex analytics may then occur inside or outside of the NHS services. Interestingly, if data are sourced from multiple organisations for the &lt;em&gt;same&lt;/em&gt; project, they can be safely linked together without needing the third-party to perform re-identification. Each organisation would send clinical data bound to the same project-specific pseudonym. As such, the pseudonymisation service can scale to support multiple organisations and allow inferences to be made across data from those organisations.&lt;/p&gt;

&lt;p&gt;This schematic shows what might happen for an AKI alerting service.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/pseudonym-aki-alert.png&quot; alt=&quot;AKI alerts&quot; class=&quot;img-responsive&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here laboratory data are taken from source systems, given a project-specific pseudonym and send for third-party analytics. The pseudonymisation service stores the patient information as well as all of the pseudonyms in use as well as patient explicit consent for inclusion (for research) and withdrawal of consent (for direct care). A log is created.&lt;/p&gt;

&lt;p&gt;If there is an AKI alert, a third-party sends back an alert to an NHS hosted service. This identifies the patient using the pseudonymisation service, allowing further logging of the results of processing. Now re-identified, the alerting service may link to the EMR and any mobile devices in order to notify the team.&lt;/p&gt;

&lt;h4 id=&quot;centralised-vs-distributed-pseudonymisation&quot;&gt;Centralised vs. distributed pseudonymisation&lt;/h4&gt;

&lt;p&gt;Readers may be familiar with the &lt;a href=&quot;https://saildatabank.com&quot;&gt;SAIL databank&lt;/a&gt; hosted by Swansea University. It uses pseudonyms to perform data linkage from multiple sources. It is a centralised pseudonymisation system, performing analysis is much like working in a smoke cupboard as one needs to use a remote desktop to run R and one cannot take data out of the closed system. In addition, a lot of the datasets were rather old when I last used the service. It is working however, and has avoided many of the controversies commonly seen when aggregated medical data is used for non-direct care purposes. One takes a clinical set, splits it into two parts containing patient identity in one and non-identifying information in another. The two are linked with a unique identifier. A secure NHS service performs the pseudonymisation and the non-identifying information is placed in a data warehouse with the pseudonym. They use a global pseudonym which allows linkage to other source of clinical data.&lt;/p&gt;

&lt;p&gt;For example, we used SAIL to show that the &lt;a href=&quot;http://jnnp.bmj.com/content/85/10/e4.187&quot;&gt;main risk of a further attendance in the emergency unit for a patient with epilepsy was their social deprivation&lt;/a&gt;.(Lynch E, Lacey A, Pickrell W, et al FACTORS ASSOCIATED WITH EMERGENCY ATTENDANCES FOR EPILEPSY J Neurol Neurosurg Psychiatry 2014;85:e4.) by linking emergency unit attendances with general practitioner records and socio-economic indices.&lt;/p&gt;

&lt;p&gt;The problem is that this is offline analysis suitable for retrospective analyses. This will not support real-time analytics or any of the innovative supporting technologies that healthcare today needs.&lt;/p&gt;

&lt;p&gt;It is here that I need help. Is it possible to create a distributed system to track patient consent for research, to provide distributed pseudonymisation and verifiable audit logs of access to data? Ideally, we would not have a centralised pseudonymisation service or a centralised audit log, but distributed systems that both maintain patient confidentiality and provide assurances as to the use of data ideally replicated among trusted organisations.&lt;/p&gt;

&lt;p&gt;My final questions are therefore:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Can &lt;a href=&quot;/clinical-informatics/2017/03/09/google-information.html&quot;&gt;Merkle trees&lt;/a&gt; be used to implement a verifiable audit-log backed key-value store service within the NHS network to store consent and access logs?&lt;/li&gt;
  &lt;li&gt;Who will act as a guardian of this service and monitor the logs?&lt;/li&gt;
  &lt;li&gt;Could this act as a pseudonymiser service, logging the pseudonymisation and the upload of non-identifiable clinical data?&lt;/li&gt;
  &lt;li&gt;Similarly, when sending data back to the NHS, could this pseudonymiser service act to link data back into the patient’s record, logging such access?&lt;/li&gt;
  &lt;li&gt;Would such a service support the safe use and monitoring of third-party applications and data analytics?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I would be grateful for your thoughts.&lt;/p&gt;

&lt;p&gt;Mark&lt;/p&gt;</content><author><name></name></author><summary type="html">“Google’s Deepmind made inexcusable errors handling UK health data”, was reported on 16th March 2017 in an article published in the journal “Health and Technology” by Julia Powles and Hal Hodson. The article is here.</summary></entry><entry><title type="html">What does ‘Once for Wales’ mean to me?</title><link href="https://www.wardle.org/clinical-informatics/2017/03/15/once-for-wales.html" rel="alternate" type="text/html" title="What does 'Once for Wales' mean to me?" /><published>2017-03-15T21:56:20+00:00</published><updated>2017-03-15T21:56:20+00:00</updated><id>https://www.wardle.org/clinical-informatics/2017/03/15/once-for-wales</id><content type="html" xml:base="https://www.wardle.org/clinical-informatics/2017/03/15/once-for-wales.html">&lt;p&gt;The following blog post is from a debate that we will have at the Welsh Clinical Informatics Council tomorrow, 16th March 2017, in relation to the current healthcare IT strategy in Wales, which has at its core, the mantra ‘Once for Wales’. This has been variously interpreted, and historically has been used to focus on a single product, such as a single patient administration system for each of the health boards in Wales. I should like to re-define this to focus on the formation of a “platform” in Wales, built on open standards and interoperability. It is essentially a summary of my larger &lt;a href=&quot;https://www.dropbox.com/s/62sg71a19voxpts/cis_design.pdf?dl=0&quot;&gt;domain-driven design clinical information system document&lt;/a&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;once-for-wales&quot;&gt;Once for Wales&lt;/h1&gt;

&lt;p&gt;So what does “Once for Wales” mean to me?&lt;/p&gt;

&lt;p&gt;To answer that question, we have to decide what we’re trying to do and what are our priorities.&lt;/p&gt;

&lt;p&gt;To that, I would answer: to valuably support the care of patients within NHS Wales.&lt;/p&gt;

&lt;p&gt;The most important priority is the patient. It is not technology, it is not politics. We need to focus on the patient, and to support health professionals and those working in the NHS in looking after the patient.&lt;/p&gt;

&lt;p&gt;How then do we support health professionals and managers in their quest to effectively look after the patients under their care?&lt;/p&gt;

&lt;h1 id=&quot;1-plan-for-innovation&quot;&gt;1. Plan for innovation&lt;/h1&gt;

&lt;p&gt;I think the most important fact to recognise is that I don’t have all of the answers. I know some of them, but many remain unsolved. Before explaining what I do know, I’d rather talk about what I don’t know, and the importance of this. We need to build an infrastructure that explicitly recognises that we don’t have all of the answers, and therefore must support innovation. Such innovation may simply be incremental improvement of existing technology, but also must cope with and embrace the introduction of transformative and disruptive technologies.&lt;/p&gt;

&lt;p&gt;The logical conclusion from this is that we need to build solutions within NHS Wales that allow innovation to flourish, but in an environment that is safe and meets the range of regulations in which we all must work.&lt;/p&gt;

&lt;h1 id=&quot;2-build-a-service-orientated-architecture&quot;&gt;2. Build a service-orientated architecture&lt;/h1&gt;

&lt;p&gt;Many people are currently interpreting “Once for Wales” as only about national systems, one portal, one emergency unit system, one patient administration system. Indeed, currently when I ask colleagues about what NWIS is doing, they know only about the “Welsh Clinical Portal” product, and little else, and I am afraid, even with all of the improvements, it is usually accompanied by a sigh and a roll of the eyes, as their experience of this product has been difficult.&lt;/p&gt;

&lt;p&gt;NWIS has done a fantastic job on the most difficult of tasks, implementing many interoperable core services than underpin much of what exists within Welsh Clinical Portal. Some of the most difficult work has been not technical, but instead has been about managing change across multiple organisations, such as the harmonisation of laboratory systems across Wales. However, because that work and those services are not currently exposed, except to Welsh Clinical Portal, few know about these successes. In my opinion, NWIS has not done enough to broadcast those successes. The Welsh Results Reports Service, integrating results from laboratories and radiology across Wales is a terrific accomplishment and the teams should be congratulated.&lt;/p&gt;

&lt;p&gt;My second conclusion is that, much like Amazon, NWIS should have a strong focus on a service-orientated architecture, and critically, those services must be made available to all within NHS Wales as well as permitted third-parties.&lt;sup&gt;&lt;a href=&quot;#amazon&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;From an engineering perspective, this makes a lot of sense. It is almost always the case that when building complex solutions to real-life problems, no-one person can conceive of all of the problems in one go. The natural solution to such complexity is to break-down a problem into manageable chunks. These chunks, much like “lego bricks”, can be joined together to form something greater than the sum of the parts. Importantly, it is more likely that we can vouch that a system is deterministic. This means that the behaviour of a system is predictable. We’ve seen the consequences of non-deterministic systems when we heard about laboratory results being misreported to general practitioners. Healthcare information technology should be deterministic.&lt;/p&gt;

&lt;p&gt;It is really difficult to know a system is doing what it should be doing when it is really complicated, so breaking systems into smaller components that do one or two things really well makes a lot of sense. It also means we can take those components and test them systematically so that we can prove that they are doing what we think they should be doing.&lt;/p&gt;

&lt;p&gt;Importantly, it is at this service-layer that a mantra of “Once for Wales” really makes sense. It doesn’t make sense to manage user authentication and authorisation in multiple services. We want single-sign-on for users, and this process should be orchestrated by a national service that handles this for multiple applications. It may be that this service federates for a range of systems across health and social care, but nationally, it makes sense to be “Once for Wales”.&lt;/p&gt;

&lt;h1 id=&quot;3-an-extensible-platform-for-nhs-wales&quot;&gt;3. An extensible platform for NHS Wales&lt;/h1&gt;

&lt;p&gt;It is therefore not difficult to imagine the core services that are truly “Once for Wales”. User authentication, laboratory and radiology results, a document repository, a reference data service, a clinical data repository. In fact, all but the last of these services exist and when combined together, form a platform on which clinical applications can sit.&lt;/p&gt;

&lt;p&gt;It is important to note that services can “wrap” or federate other services to provide additional functionality. A service to provide laboratory results can connect to multiple laboratory systems and provide a unified view. Such integration does not require all laboratories to use the same product, but only expose their data in a standardised way with harmonisation of meaning, so that a full blood count in one system is equivalent to a full blood count in another system. There is a growing momentum towards a standards-based approach internationally.&lt;/p&gt;

&lt;p&gt;Similarly, the fact that the same patient administrative system is in use in multiple organisations does not magically mean that we can track the care of a patient on a single pathway that spans those organisations. The logical conclusion is that it is much more important to think about high-level clinical requirements than focus on products, and that services can be combined together to form an extensible platform.&lt;/p&gt;

&lt;h1 id=&quot;4-focus-on-standards-and-contracts&quot;&gt;4. Focus on standards and contracts&lt;/h1&gt;

&lt;p&gt;I’ve previously quipped that I don’t care what system is used in the emergency department. That isn’t quite true, but I’m not an expert on the workflows and processes that occur in an emergency unit. What I am interested in is knowing how many of my patients attend the emergency unit, how patients at the front-door flow through my hospital and which of them I need to see when I am on-call. I might want to set-up some automatic notification when one of my patients with motor neurone disease turns up in the department.&lt;/p&gt;

&lt;p&gt;As a relative outsider, it is logical for me to think about emergency unit systems as a black-box. I don’t need to see how it is implemented, what magic goes on under the lid, but I do need a report telling me what has happened to the patient. For me therefore, a “Once for Wales” approach means focusing on a “Once for Wales” contract  - a contract in which we give the high-level functional requirements and expect organisations and third-parties to meet those contracts.  Those contracts are a combination of clinical requirements (for instance, notifications) and technical - so that we know it will interoperate.&lt;/p&gt;

&lt;p&gt;Similarly, the same could be said for specialty-specific systems like nephrology or ophthalmology.&lt;/p&gt;

&lt;p&gt;Now it may make sense financially to procure a single EU product for use across Wales, it may not. As a member of council, I’m not sure I should have any say at all. To me, the EU system needs to interoperate with the workflow and processes within that organisation, and that is pretty much none of my business. All I want is for it to meet the requirements firstly of the EU staff, secondly, the organisation and its management, and thirdly, everyone else who looks after that patient.&lt;/p&gt;

&lt;p&gt;A focus on a single product stops us thinking about what really matters across NHS Wales. We should be discussing what is in that contract for any EU system and how it interoperates with our national platform. It is the contract that is “Once for Wales”, what data standards must be used and not the details of the implementation. It avoids a procurement like WCCIS, in which we still don’t have a handle on how this project will interoperate with the rest of our architecture.&lt;/p&gt;

&lt;p&gt;Such an approach then permits local innovation and for local organisations to work at their own pace and priorities. Our health boards are under a statutory obligation to provide healthcare for their populations. We must avoid a “my way or the highway” approach, but allow local developments in order to solve local problems that can work in harmony with the national platform. Importantly, we must then create an environment where we can pick up those local innovations and easily apply them in different organisations preventing wasteful duplication of effort, or the creation of functional silos which cannot interoperate with any other system.&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;I therefore commend to council that we re-imagine “Once for Wales” to focus on a “platform” for Wales, a set of contracts, data standards and integration services. Welsh Clinical Portal should be but one window into our national platform. We need a national architecture board in which we define those core national services, define those data standards and evaluate products to ensure that are truly interoperable with our platform. The final piece of “Once for Wales” should be a plan to develop a workforce of informatics staff, clinical and technical, who can make healthcare IT in Wales the best in the world.&lt;/p&gt;

&lt;p&gt;Thank you,&lt;/p&gt;

&lt;p&gt;Mark Wardle&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h1&gt;

&lt;p&gt;&lt;a name=&quot;amazon&quot;&gt;1&lt;/a&gt;: Jeff Bezos did the same for Amazon in 2002, with the &lt;a href=&quot;http://apievangelist.com/2012/01/12/the-secret-to-amazons-success-internal-apis/&quot;&gt;following commandments&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;All teams will henceforth expose their data and functionality through service interfaces.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Teams must communicate with each other through these interfaces.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;There will be no other form of inter-process communication allowed: no direct linking, no direct reads of another team’s data store, no shared-memory model, no back-doors whatsoever. The only communication allowed is via service interface calls over the network.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;It doesn’t matter what technology they use.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;All service interfaces, without exception, must be designed from the ground up to be externalizable. That is to say, the team must plan and design to be able to expose the interface to developers in the outside world. No exceptions.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><summary type="html">The following blog post is from a debate that we will have at the Welsh Clinical Informatics Council tomorrow, 16th March 2017, in relation to the current healthcare IT strategy in Wales, which has at its core, the mantra ‘Once for Wales’. This has been variously interpreted, and historically has been used to focus on a single product, such as a single patient administration system for each of the health boards in Wales. I should like to re-define this to focus on the formation of a “platform” in Wales, built on open standards and interoperability. It is essentially a summary of my larger domain-driven design clinical information system document.</summary></entry></feed>